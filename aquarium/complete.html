<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>광화문 해치마당 - 아쿠아리움</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="mobile-web-app-capable" content="yes" />
    <link href="https://unpkg.com/swiper@7/swiper-bundle.min.css" rel="stylesheet" />
    <!--link href="assets/front/common/css/reset.css" rel="stylesheet" type="text/css" />-->
    <link href="assets/front/aquarium/css/style.css" rel="stylesheet" type="text/css" />
    <link href="assets/front/aquarium/css/svg_fish.css" rel="stylesheet" type="text/css" />
    <link href="assets/front/aquarium/css/svg_fish_bg.css" rel="stylesheet" type="text/css" />
    <script src="https://code.jquery.com/jquery-latest.min.js"></script>
    <script src="https://unpkg.com/swiper@7/swiper-bundle.min.js"></script>
    <script src="assets/front/aquarium/lib/iro/iro.min.js"></script>
    <script src="assets/front/aquarium/js/common.js"></script>

</head>

<body class="">
<div class="wrapper wrapper--exp border-box">
    <div class="contents">
        <div class="inner">
            <!-- 전송 완료 -->
            <div class="cont__exp">
                <div class="exp__tit">
                    <p class="tx_sub">Complete</p>
                    <p class="tx_tit">참여 완료</p>
                </div>

                <div class="exp__comp border-box">
                    <p class="tx_msg1">물고기가 <strong>“광화 아쿠아리움”</strong> 에 <br> 전송되었습니다.</p>
                    <p class="tx_msg2">지금 바로 '미디어월'에서 <br>물고기를 확인해보세요~!!</p>
                    <p class="tx_msg3">참여해주셔서 감사합니다.</p>

                    <div class="svg__area">
                        <!-- 캡쳐 영역 -->
                        <div class="capture_box"></div>
                        <div class="bg__brush"></div>
                    </div>
                </div>
            </div>
            <!-- // -->
            <script>
                const fish_index = 1; // 선택한 물고기
                const COLORHEX = ['#0810ff', '#ff0a0e', '#ff24ed']; // 색칠 면 HEXCODE
                const BRUSH_NUMBER = ['0', '1', '2']; // 순서대로 브러쉬 번호 입력
                const MATRIXVALUE = ['0 0 0 0 0.03137254901960784 0 0 0 0 0.06274509803921569 0 0 0 0 1 0 0 0 1 0', '0 0 0 0 1 0 0 0 0 0.0392156862745098 0 0 0 0 0.054901960784313725 0 0 0 1 0', '0 0 0 0 1 0 0 0 0 0.1411764705882353 0 0 0 0 0.9294117647058824 0 0 0 1 0'];

                // 물고기 색칠하기
                function drawFish() {
                    // SVG 파일 내 JS 제어
                    const FISHSVG = document.querySelector('.fishsvg');
                    const SVGDOC = FISHSVG.contentDocument;// contentDocument 속성으로 접근
                    const FISHDIV = SVGDOC.querySelectorAll("g[id^='fishDiv']");
                    const FISHDIV_LENGTH = FISHDIV.length; // 면 갯수

                    // feColorMatrix SVG 삽입 : 면 갯수대로 추가
                    let filterHtml = "";
                    filterHtml += "<svg x=0 y=0 width=500 height=500 id='brushSvg' color-interpolation-filters='sRGB'>";
                    filterHtml += "<defs>";
                    for(let i = 0; i < FISHDIV_LENGTH; i++) {
                        filterHtml += "<filter id='f" + i + "' x='0' y='0' width='100%' height='100%'>";
                        filterHtml += "     <feColorMatrix type='matrix' values='1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0' />";
                        filterHtml += "</filter>";
                    }
                    filterHtml += "</defs>";
                    for(let i = 0; i < FISHDIV_LENGTH; i++) {
                        filterHtml += "<image class='brush-div-" + i + " is-hidden' xlink:href='' x='0' y='0' height='100%' width='100%' />";
                    }
                    filterHtml += "</svg>";

                    $(".bg__brush").html(filterHtml);

                    for(let i = 0; i < FISHDIV_LENGTH; i++) {
                        let svgDoc = SVGDOC.querySelectorAll("#fishDiv" + i + " .fish-div")

                        if(BRUSH_NUMBER[i] != null) { // 브러쉬 선택된 면은 브러쉬+컬러매트릭스 적용
                            $(svgDoc).css({"fill" : "transparent"});
                            $(".brush-div-" + i)
                            .attr("xlink:href", "assets/front/aquarium/images/fishbrush/" + fish_index + "_" + BRUSH_NUMBER[i] + "_" + i + ".png")
                            .css({
                                "-webkit-filter" : "url(#f" + i + ")",
                                "filter" : "url(#f" + i + ")",
                                "opacity" : 1
                            })

                            $("#f" + i + " feColorMatrix").attr({"values" : MATRIXVALUE[i]})
                        } else { // 브러쉬 선택하지 않은 면은 색칠
                            $(svgDoc).css({"fill" : COLORHEX[i]})
                            $(".brush-div-" + i).css({"opacity" : 0})
                        }

                    }
                }

                $(window).load(function() {
                    drawFish();
                });

                $(function() {
                    $(".svg__area > .capture_box").append(`<object class="fishsvg" type="image/svg+xml" data="assets/front/aquarium/images/fishsvg/result/fish${fish_index}.svg"></object>`);
                    $(".svg__area > .capture_box").append(`<object class="fishsvg_bg" type="image/svg+xml" data="assets/front/aquarium/images/fishsvg/bg/fish${fish_index}.svg"></object>`);
                });
            </script>
        </div>
    </div>
</div>
</body>
</html>